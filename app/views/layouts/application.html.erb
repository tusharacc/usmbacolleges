<!DOCTYPE html>
<html>
<head>
  <title>MBA Colleges in US</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <%= favicon_link_tag 'favicon.ico' %>
  <%= include_gon %>
  <%= stylesheet_link_tag    "application", media: "all", "data-turbolinks-track" => true %>
  <%= javascript_include_tag "application", "data-turbolinks-track" => true %>
  <%= csrf_meta_tags %>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
</head>
<body>
	<div id="container-fluid">
    
    <div style="background:black;color:white;">
    <form class="form-inline" style="margin-left:20%;">

      <input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" id="stateInput" placeholder="State" onchange="FilterState()">
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio1" value="25" onchange="FilterState()"> Top 25 Ranked College
        </label>
      </div>
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio2" value="50" onchange="FilterState()"> Between 26-50
        </label>
      </div>
      <div class="form-check form-check-inline">
        <label class="form-check-label">
          <input class="form-check-input" type="radio" name="inlineRadioOptions" id="inlineRadio3" value="All" checked onchange="FilterState()"> All colleges
        </label>
      </div>
    </form>
  </div>
		<%= yield %>
	</div>
  <div style="background:black;color:white;position: fixed;bottom:0%;width:100%;">
    Please click on Markers
  </div>
  <script>
    const states = ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'District of Columbia', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'];
    $( "#stateInput" ).autocomplete({
      source: states
    });
  </script>
  <script>
    function FilterState(){
    var state = document.getElementById('stateInput').value;
    var rank = document.querySelector('input[name = "inlineRadioOptions"]:checked').value;
    var doNotCheckLocation = false;
    if (!Boolean(state)){
      console.log('Inside State :', state);
      doNotCheckLocation = true;
    }
    
    colleges = gon.colleges;
    var start=0,end=0;
    switch (rank) {
      case '25':
        start = 0;
        end = 26;
        break;
      case '50':
        start = 26;
        end = 51;
        break;
      default:
        start = 0;
        end = colleges.length;
        break;
    }
    console.log("State :", state);
    console.log("Start :", start);
    console.log("End :", end);
    //console.log ("Colleges :", colleges);
    var filteredArray = [];
    for (i = start; i < end; i++){
      location_array = colleges[i].location.split(',');
      college_state = location_array[location_array.length-1];
      if (college_state.trim() == state || doNotCheckLocation) {
        filteredArray.push(colleges[i]);
      }
    }
    colleges = filteredArray;
    console.log('Filetered Array :',filteredArray);
    initMap(state);
  }
    document.getElementById("stateInput").addEventListener("onchange", FilterState);
  </script>
</body>
</html>